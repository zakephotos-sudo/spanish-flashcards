<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Spanish Trainer</title>
<style>
body { font-family:-apple-system; background:#111; color:white; margin:0; }
.screen { padding:20px; }
button { padding:12px; margin:5px 0; width:100%; border:none; border-radius:10px; background:#222; color:white; }
.card { background:#1d1d25; padding:40px 20px; font-size:28px; text-align:center; border-radius:20px; margin-top:20px; }
.hidden { display:none; }
.topbar { display:flex; justify-content:space-between; }
.small { font-size:12px; opacity:.6; }
</style>
</head>
<body>

<div id="menu" class="screen">
  <h2>Select Category</h2>
  <button onclick="selectCategory('everyday')">Everyday</button>
  <button onclick="selectCategory('travel')">Travel</button>
  <button onclick="selectCategory('business')">Business</button>
</div>

<div id="levels" class="screen hidden">
  <h2>Select Level</h2>
  <button onclick="selectLevel(1)">Level 1</button>
  <button onclick="selectLevel(2)">Level 2</button>
  <button onclick="selectLevel(3)">Level 3</button>
  <button onclick="goBack()">Back</button>
</div>

<div id="study" class="screen hidden">
  <div class="topbar">
    <button onclick="exitStudy()">Menu</button>
    <div id="progress" class="small"></div>
  </div>

  <div id="card" class="card" onclick="flipCard()">Loading...</div>

  <button onclick="markCorrect()">Correct</button>
  <button onclick="markWrong()">Wrong</button>
  <button onclick="playAudio()">ðŸ”Š Pronounce</button>
  <button onclick="shuffle()">ðŸ”€ Shuffle</button>
</div>

<script>
let words = [];
let filtered = [];
let current = 0;
let flipped = false;
let selectedCategory = "";
let selectedLevel = 1;

fetch("words.json")
.then(r=>r.json())
.then(data=>{
  words = data;
});

function selectCategory(cat){
  selectedCategory = cat;
  menu.classList.add("hidden");
  levels.classList.remove("hidden");
}

function selectLevel(level){
  selectedLevel = level;
  filtered = words.filter(w=>w.category===selectedCategory && w.level===level);
  current=0;
  flipped=false;
  levels.classList.add("hidden");
  study.classList.remove("hidden");
  updateCard();
}

function updateCard(){
  if(!filtered.length){ card.textContent="No words"; return;}
  let word = filtered[current];
  card.textContent = flipped ? word.en : word.es;
  progress.textContent = (current+1)+" / "+filtered.length;
}

function flipCard(){ flipped=!flipped; updateCard(); }

function markCorrect(){
  let word = filtered[current];
  word.correct = (word.correct||0)+1;
  nextCard();
}

function markWrong(){
  let word = filtered[current];
  word.correct = 0;
  nextCard();
}

function nextCard(){
  current=(current+1)%filtered.length;
  flipped=false;
  updateCard();
  localStorage.setItem("progress", JSON.stringify(words));
}

function shuffle(){
  filtered.sort(()=>Math.random()-0.5);
  current=0;
  updateCard();
}

function playAudio(){
  let utter = new SpeechSynthesisUtterance(filtered[current].es);
  utter.lang="es-ES";
  speechSynthesis.speak(utter);
}

function goBack(){
  levels.classList.add("hidden");
  menu.classList.remove("hidden");
}

function exitStudy(){
  study.classList.add("hidden");
  menu.classList.remove("hidden");
}
</script>

</body>
</html>